<!DOCTYPE html>
<html>
<head>
<style>
html, body {
    width: 90%;
    height: 90%;
}
#graph {
    border: 2px solid blue;
    width: 800px;
    height: 600px;
}
#container {
    display: none;
}
</style>
</head>
<body>

<div id="loading">
    Please wait...
</div>

<div id="container">

    <input type="file" id="profile-file" />
    <select id="profile-format">
        <option value="axe">AXE</option>
        <option value="callgrind">Callgrind</option>
        <option value="hprof">HProf</option>
        <option value="oprofile">OProfile</option>
        <option value="perf">Perf</option>
        <option value="prof">Gprof</option>
        <option value="pstats">pstats (Python)</option>
        <option value="sleepy">Sleepy</option>
        <option value="sysprof">Sysprof</option>
        <option value="xperf">XPerf</option>
        <option value="dtrace">DTrace</option>
    </select>
    <button id="gprof2dot-btn">gprof2dot</button>

    <div id="graph"></div>

</div>

<!-- TODO use modules once https://github.com/jspm/project/issues/75 is fixed -->
<script src="//d3js.org/d3.v5.min.js"></script>
<script src="https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js"></script>
<script src="https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js"></script>

<script defer src="https://cdn.jsdelivr.net/npm/es-module-shims@0.5.0/dist/es-module-shims.min.js"></script>
<script type="importmap-shim">
{
    "imports": {
        "d3": "https://jspm.dev/d3@5.16.0",
        "d3-graphviz": "https://jspm.dev/d3-graphviz@3.0.4"
    },
    "scopes": {
    }
}
</script>

<script src="https://pyodide-cdn2.iodide.io/v0.15.0/full/pyodide.js"></script>

<script type="module-shim">
import { main } from "./main.js";

async function bootstrap() {
    // Wait for pyodide to initialize.
    await languagePluginLoader;

    // Load additional wheels from PyPI / custom URLs.
    await pyodide.runPythonAsync(`
        import micropip
        micropip.install('${window.location.href}wheels/gprof2dot-2019.11.30-py3-none-any.whl')
    `);
    
    // Start the app.
    main();
}
bootstrap();
</script>
</body>
</html>
